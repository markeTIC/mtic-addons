<?xml version="1.0" encoding="utf-8"?>
<openerp>
<data>
<template id="report_maintenance_order_list">
    <t t-call="report.html_container">
        <t t-call="report.external_layout">
            <div class="page">

                <div class="row mt8">
                    <div class="col-xs-12" style="text-align: center;">
                        <h3>
                            ÓRDENES DE MANTENIMIENTO
                            <span t-if="data['form']['list_type'] == 'C'">CORRECTIVO</span>
                            <span t-if="data['form']['list_type'] == 'P'">PREVENTIVO</span>
                            <span t-if="data['form']['list_type'] == 'L'">LEGAL</span>
                        </h3>
                    </div>
                    <div class="col-xs-12" style="text-align: center;">
                        <strong>Desde: </strong><span t-esc="formatLang(data['form']['from_date'], date=True)"/>
                        <strong>Hasta: </strong><span t-esc="formatLang(data['form']['to_date'], date=True)"/>
                        <span t-if="data['form']['status'] == 'closed'">[Realizadas]</span>
                        <span t-if="data['form']['status'] == 'pending'">[No realizadas]</span>
                        <span t-if="data['form']['stop_time'] == 'yes'">[Con tiempo de paro]</span>
                        <span t-if="data['form']['stop_time'] == 'no'">[Sin tiempo de paro]</span>
                    </div>
                    <div class="col-xs-12" style="text-align: center;"
                         t-if="data['form']['origin_employee_id'] or data['form']['assigned_employee_id'] or data['form']['asset_line_id'] or data['form']['asset_id']">
                        <t t-if="data['form']['origin_employee_id']">
                            <strong>Solicitado por: </strong>
                            <span t-esc="data['form']['origin_employee_id_name']"/>
                        </t>
                        <t t-if="data['form']['assigned_employee_id']">
                            <strong>Asignada a: </strong>
                            <span t-esc="data['form']['assigned_employee_id_name']"/>
                        </t>
                        <t t-if="data['form']['asset_line_id']">
                            <strong>Línea: </strong>
                            <span t-esc="data['form']['asset_line_id_name']"/>
                        </t>
                        <t t-if="data['form']['asset_id']">
                            <strong>Máquina: </strong>
                            <span t-esc="data['form']['asset_id_name']"/>
                        </t>
                    </div>
                </div>

                <t t-set="calc_total_count" t-value="0"/>
                <t t-set="calc_total_repair_time" t-value="0"/>
                <t t-set="calc_total_stop_time" t-value="0"/>
                <t t-set="calc_total_stop_time_rated" t-value="0"/>
                <t t-set="calc_total_work_time" t-value="0"/>
                <table class="table table-condensed">
                    <thead>
                        <tr>
                            <th>
                                <div class="row mt16">
                                    <div class="col-xs-1 text-center">
                                        <strong>ORDEN</strong>
                                    </div>
                                    <div class="col-xs-1 text-center">
                                        <strong>ESTADO</strong>
                                    </div>
                                    <div class="col-xs-3">
                                        <strong>LINEA</strong>
                                    </div>
                                    <div class="col-xs-3">
                                        <strong>MÁQUINA</strong>
                                    </div>
                                    <div class="col-xs-2">
                                        <strong>SOLICITADO</strong>
                                    </div>
                                    <div class="col-xs-1 text-center">
                                        <strong>FECHA</strong>
                                    </div>
                                    <div class="col-xs-1 text-center">
                                        <strong>TURNO</strong>
                                    </div>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="get_orders(data['form'])" t-as="o">
                            <td>
                                <div class="row mt8">
                                    <div class="col-xs-1 text-center">
                                        <span t-esc="o['code']"/>
                                    </div>
                                    <div class="col-xs-1 text-center nopadding">
                                        <span t-if="o['state'] == 'pending'">Pendiente</span>
                                        <span t-if="o['state'] == 'stop'">Paro</span>
                                        <span t-if="o['state'] == 'planned'">Planificada</span>
                                        <span t-if="o['state'] == 'open'">En curso</span>
                                        <span t-if="o['state'] == 'parts'">Pdte. repuestos</span>
                                        <span t-if="o['state'] == 'scaled'">Pdte. terceros</span>
                                        <span t-if="o['state'] == 'finished'">Finalizada</span>
                                        <span t-if="o['state'] == 'closed'">Cerrada</span>
                                        <span t-if="o['state'] == 'canceled'">Cancelada</span>
                                    </div>
                                    <div class="col-xs-3">
                                        <span t-esc="o['asset_level1']"/>
                                    </div>
                                    <div class="col-xs-3">
                                        <span t-esc="o['asset_id']"/>
                                    </div>
                                    <div class="col-xs-2">
                                        <span t-esc="o['origin_employee_id']"/>
                                    </div>
                                    <div class="col-xs-1 text-center nopadding">
                                        <span t-esc="formatLang(o['date'], date=True)"/>
                                    </div>
                                    <div class="col-xs-1 text-center">
                                        <span t-esc="o['work_shift']"/>
                                    </div>
                                </div>

                                <div class="row" t-if="o['description']">
                                    <div class="col-xs-1 text-right nopadding">
                                        <strong>DESCRIP.:</strong>
                                    </div>
                                    <div class="col-xs-11">
                                        <span t-esc="o['description']"/>
                                    </div>
                                </div>

                                <div class="row" t-if="o['solution_description']">
                                    <div class="col-xs-1 text-right nopadding">
                                        <strong>RESULTADO:</strong>
                                    </div>
                                    <div class="col-xs-7">
                                        <span t-esc="o['solution_description']"/>
                                    </div>
                                    <div class="col-xs-2 nopadding">
                                        <strong>F. FIN:</strong>
                                        <span t-esc="formatLang(o['end_date'], date=True)"/>
                                    </div>
                                    <div class="col-xs-1 nopadding">
                                        <strong>T.REP.:</strong>
                                        <span t-esc="o['repair_time']"/>
                                    </div>
                                    <div class="col-xs-1 nopadding" t-if="o['stop_time_rated'] > 0">
                                        <strong>T. PARO:</strong>
                                        <span t-esc="o['stop_time_rated']"/>
                                    </div>
                                </div>

                                <div class="row" t-if="o['worker_ids'] or o['part_ids']">
                                    <div class="col-xs-1 text-right nopadding">
                                        <t t-if="o['worker_ids']">
                                            <strong>TRABAJAD.:</strong>
                                        </t>
                                    </div>
                                    <div class="col-xs-4">
                                        <t t-foreach="o['worker_ids']" t-as="w">
                                            <span t-esc="w_value['employee_id']"/>: <span t-esc="w_value['work_time']"/> minutos<br/>
                                            <!-- Actualizamos totales -->
                                            <t t-set="calc_total_work_time" t-value="calc_total_work_time + w_value['work_time']"/>
                                        </t>
                                    </div>
                                    <div class="col-xs-1 text-right nopadding" t-if="o['part_ids']">
                                        <strong>RECAMBIOS:</strong>
                                    </div>
                                    <div class="col-xs-6" t-if="o['part_ids']">
                                        <t t-foreach="o['part_ids']" t-as="p">
                                            <span t-esc="p['barcode']"/> - <span t-esc="p['description']"/>: <span t-esc="p['qty']"/> ud.<br/>
                                        </t>
                                    </div>
                                </div>

                                <div class="row" t-if="o['notes']">
                                    <div class="col-xs-1 text-right nopadding">
                                        <strong>NOTAS:</strong>
                                    </div>
                                    <div class="col-xs-11">
                                        <span t-esc="o['notes']"/>
                                    </div>
                                </div>

                                <!-- Actualizamos totales -->
                                <t t-set="calc_total_count" t-value="calc_total_count + 1"/>
                                <t t-set="calc_total_repair_time" t-value="calc_total_repair_time + o['repair_time']"/>
                                <t t-set="calc_total_stop_time" t-value="calc_total_stop_time + o['stop_time']"/>
                                <t t-set="calc_total_stop_time_rated" t-value="calc_total_stop_time_rated + o['stop_time_rated']"/>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="row mt16">
                    <div class="col-xs-2">
                        <strong>N. ÓRDENES: </strong><span t-esc="'{:,d}'.format(calc_total_count).replace(',', '.')"/>
                    </div>
                    <div class="col-xs-3">
                        <strong>TOTAL TIEMPO REP: </strong><span t-esc="'{:,d}'.format(calc_total_repair_time).replace(',', '.')"/> min<br/>
                        <strong>TOTAL TIEMPO TRAB.: </strong><span t-esc="'{:,d}'.format(calc_total_work_time).replace(',', '.')"/> min
                    </div>
                    <div class="col-xs-4">
                        <strong>TOTAL TIEMPO PARO MAQ.: </strong><span t-esc="'{:,d}'.format(calc_total_stop_time).replace(',', '.')"/> min<br/>
                        <strong>TOTAL TIEMPO PARO PROD.: </strong><span t-esc="'{:,d}'.format(calc_total_stop_time_rated).replace(',', '.')"/> min
                    </div>
                </div>

            </div>
        </t>
    </t>
</template>

</data>
</openerp>
